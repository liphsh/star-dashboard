<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>星愿计划 ⭐</title>
    <link rel="stylesheet" href="styles.css?v=3">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=ZCOOL+KuaiLe&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- 顶部装饰 -->
        <div class="top-decoration">
            <div class="cloud cloud-1">☁️</div>
            <div class="cloud cloud-2">☁️</div>
            <div class="sun">🌞</div>
        </div>

        <!-- 模式切换 -->
        <div class="mode-switcher">
            <button id="homeMode" class="mode-btn active" onclick="switchMode('home')">
                <span class="mode-icon">🏠</span>
                <span class="mode-text">在家</span>
            </button>
            <button id="awayMode" class="mode-btn" onclick="switchMode('away')">
                <span class="mode-icon">✈️</span>
                <span class="mode-text">在外</span>
            </button>
        </div>

        <!-- 星星黑板 -->
        <div class="star-blackboard">
            <div class="blackboard-header">
                <div class="blackboard-title">
                    <span class="chalk-icon">📋</span>
                    <span>我的星星黑板</span>
                </div>
                <div class="star-total">
                    <span class="total-label">共</span>
                    <span class="total-count" id="starCount">0</span>
                    <span class="total-label">颗</span>
                </div>
            </div>
            <div class="blackboard-content">
                <div class="stars-grid" id="starsGrid">
                    <!-- 星星将通过JS动态生成 -->
                </div>
                <div class="empty-blackboard" id="emptyBlackboard">
                    <span class="empty-icon">🌙</span>
                    <p>还没有星星哦~</p>
                    <p class="empty-hint">快去完成任务获得星星吧！</p>
                </div>
            </div>
            <div class="blackboard-footer">
                <div class="away-stars-hint" id="awayStarsHint">
                    <span class="away-icon">✈️</span>
                    <span id="awayStarsCount">0</span> 颗在外获得（粉色标记）
                </div>
                <div class="month-hint">
                    <span>📅</span> 显示最近30天的星星
                </div>
            </div>
        </div>

        <!-- 操作按钮 -->
        <div class="action-buttons">
            <button class="action-btn add-btn" onclick="showAddModal()">
                <span class="btn-icon">➕</span>
                <span class="btn-text">获得星星</span>
            </button>
            <button class="action-btn remove-btn" onclick="showRemoveModal()">
                <span class="btn-icon">➖</span>
                <span class="btn-text">失去星星</span>
            </button>
        </div>

        <!-- 功能菜单 -->
        <div class="menu-buttons">
            <button class="menu-btn wish-btn" onclick="showWishList()">
                <span class="menu-icon">🎁</span>
                <span>我的心愿</span>
            </button>
            <button class="menu-btn" onclick="showHistory()">
                <span class="menu-icon">📋</span>
                <span>星星记录</span>
            </button>
            <button class="menu-btn sync-btn" id="syncBtn" onclick="showSyncModal()">
                <span class="menu-icon">✏️</span>
                <span>同步到黑板</span>
            </button>
            <button class="menu-btn" onclick="showSnapshot()">
                <span class="menu-icon">📸</span>
                <span>外出快照</span>
            </button>
        </div>

        <!-- 底部装饰 -->
        <div class="bottom-decoration">
            <div class="grass"></div>
            <div class="flower flower-1">🌸</div>
            <div class="flower flower-2">🌼</div>
            <div class="flower flower-3">🌷</div>
        </div>
    </div>

    <!-- 添加星星弹窗 -->
    <div class="modal" id="addModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>🌟 获得星星</h2>
                <button class="close-btn" onclick="closeModal('addModal')">✕</button>
            </div>
            <div class="modal-body">
                <p class="modal-hint">宝贝做到了什么呢？</p>
                <div class="reason-buttons">
                    <button class="reason-btn" onclick="addStar('按时吃饭')">
                        <span class="reason-icon">🍚</span>
                        <span>按时吃饭</span>
                    </button>
                    <button class="reason-btn" onclick="addStar('按时睡觉')">
                        <span class="reason-icon">😴</span>
                        <span>按时睡觉</span>
                    </button>
                    <button class="reason-btn" onclick="addStar('参加运动')">
                        <span class="reason-icon">⚽</span>
                        <span>参加运动</span>
                    </button>
                    <button class="reason-btn custom-btn" onclick="showCustomReason('add')">
                        <span class="reason-icon">✨</span>
                        <span>其他原因</span>
                    </button>
                </div>
                <div class="custom-input-area" id="addCustomArea" style="display: none;">
                    <input type="text" id="addCustomReason" placeholder="输入获得星星的原因..." maxlength="50">
                    <button class="confirm-custom-btn" onclick="addStarCustom()">确定</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 减少星星弹窗 -->
    <div class="modal" id="removeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>😢 失去星星</h2>
                <button class="close-btn" onclick="closeModal('removeModal')">✕</button>
            </div>
            <div class="modal-body">
                <p class="modal-hint">发生了什么呢？</p>
                <div class="reason-buttons">
                    <button class="reason-btn remove" onclick="removeStar('没有按时吃饭')">
                        <span class="reason-icon">🍚</span>
                        <span>没按时吃饭</span>
                    </button>
                    <button class="reason-btn remove" onclick="removeStar('没有按时睡觉')">
                        <span class="reason-icon">😴</span>
                        <span>没按时睡觉</span>
                    </button>
                    <button class="reason-btn remove" onclick="removeStar('没有参加运动')">
                        <span class="reason-icon">⚽</span>
                        <span>没参加运动</span>
                    </button>
                    <button class="reason-btn remove custom-btn" onclick="showCustomReason('remove')">
                        <span class="reason-icon">📝</span>
                        <span>其他原因</span>
                    </button>
                </div>
                <div class="custom-input-area" id="removeCustomArea" style="display: none;">
                    <input type="text" id="removeCustomReason" placeholder="输入失去星星的原因..." maxlength="50">
                    <button class="confirm-custom-btn remove" onclick="removeStarCustom()">确定</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 历史记录弹窗 -->
    <div class="modal" id="historyModal">
        <div class="modal-content history-modal">
            <div class="modal-header">
                <h2>📋 星星记录</h2>
                <button class="close-btn" onclick="closeModal('historyModal')">✕</button>
            </div>
            <div class="modal-body">
                <div class="history-filter">
                    <button class="filter-btn active" onclick="filterHistory('all')">全部</button>
                    <button class="filter-btn" onclick="filterHistory('add')">获得</button>
                    <button class="filter-btn" onclick="filterHistory('remove')">失去</button>
                    <button class="filter-btn" onclick="filterHistory('away')">在外</button>
                </div>
                <div class="history-list" id="historyList">
                    <!-- 历史记录将通过JS动态生成 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 同步到黑板弹窗 -->
    <div class="modal" id="syncModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>✏️ 同步到黑板</h2>
                <button class="close-btn" onclick="closeModal('syncModal')">✕</button>
            </div>
            <div class="modal-body">
                <div class="sync-info">
                    <p>在外期间的星星变化：</p>
                    <div class="sync-stats">
                        <div class="sync-stat add">
                            <span class="sync-icon">➕</span>
                            <span id="syncAddCount">0</span>
                            <span>颗新获得</span>
                        </div>
                        <div class="sync-stat remove">
                            <span class="sync-icon">➖</span>
                            <span id="syncRemoveCount">0</span>
                            <span>颗失去</span>
                        </div>
                    </div>
                    <div class="sync-details" id="syncDetails">
                        <!-- 同步详情将通过JS动态生成 -->
                    </div>
                </div>
                <p class="sync-hint">确认后，在外的星星将变为正常颜色</p>
                <button class="sync-confirm-btn" onclick="syncToBlackboard()">
                    <span>✅</span> 已抄写到黑板
                </button>
            </div>
        </div>
    </div>

    <!-- 外出快照弹窗 - 出发前同步黑板数据 -->
    <div class="modal" id="snapshotModal">
        <div class="modal-content snapshot-modal">
            <div class="modal-header">
                <h2>✈️ 出发前同步</h2>
                <button class="close-btn" onclick="closeModal('snapshotModal')">✕</button>
            </div>
            <div class="modal-body">
                <div class="snapshot-content">
                    <!-- 步骤提示 -->
                    <div class="sync-steps">
                        <div class="step-item">
                            <span class="step-num">1</span>
                            <span>看一下家里黑板上有多少颗星星</span>
                        </div>
                        <div class="step-item">
                            <span class="step-num">2</span>
                            <span>在下方输入星星总数</span>
                        </div>
                        <div class="step-item">
                            <span class="step-num">3</span>
                            <span>点击"开始旅行"即可出发啦！</span>
                        </div>
                    </div>

                    <!-- 星星输入卡片 -->
                    <div class="snapshot-card">
                        <div class="snapshot-date" id="snapshotDate">2024年1月1日</div>
                        <div class="blackboard-sync-area">
                            <div class="sync-label">🏠 黑板上的星星总数</div>
                            <div class="big-input-area">
                                <span class="input-star">⭐</span>
                                <input type="number" 
                                       class="big-star-input" 
                                       id="snapshotTotal" 
                                       value="0" 
                                       min="0" 
                                       inputmode="numeric"
                                       onclick="this.select()"
                                       onchange="onSnapshotCountChange()"
                                       onkeyup="onSnapshotCountChange()">
                                <span class="input-unit">颗</span>
                            </div>
                            <div class="current-app-count">
                                📱 当前APP记录：<span id="currentAppCount">0</span> 颗
                                <span class="diff-hint" id="diffHint"></span>
                            </div>
                        </div>

                        <!-- 最近记录预览 -->
                        <div class="recent-records-preview">
                            <h4>📝 最近记录</h4>
                            <div class="recent-records-list" id="recentRecords">
                                <!-- 最近记录将通过JS动态生成 -->
                            </div>
                        </div>
                    </div>

                    <!-- 开始旅行按钮 -->
                    <button class="start-travel-btn" onclick="startTravel()">
                        <span>✈️</span> 开始旅行
                    </button>
                    <p class="travel-hint">同步后，旅途中获得的星星会用粉色标记</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 心愿列表弹窗 -->
    <div class="modal" id="wishListModal">
        <div class="modal-content wish-modal">
            <div class="modal-header">
                <h2>🎁 我的心愿</h2>
                <button class="close-btn" onclick="closeModal('wishListModal')">✕</button>
            </div>
            <div class="modal-body">
                <!-- 当前星星提示 -->
                <div class="wish-star-info">
                    <span>⭐</span>
                    <span>当前拥有 <strong id="wishCurrentStars">0</strong> 颗星星</span>
                </div>
                
                <!-- 心愿列表 -->
                <div class="wish-list" id="wishList">
                    <!-- 心愿将通过JS动态生成 -->
                </div>
                
                <!-- 添加心愿按钮 -->
                <button class="add-wish-btn" onclick="showAddWishModal()">
                    <span>✨</span> 许一个新心愿
                </button>
                
                <!-- 查看已实现心愿 -->
                <button class="view-fulfilled-btn" onclick="showFulfilledWishes()">
                    <span>🏆</span> 已实现的心愿
                </button>
            </div>
        </div>
    </div>

    <!-- 添加/编辑心愿弹窗 -->
    <div class="modal" id="addWishModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="wishModalTitle">✨ 许个心愿</h2>
                <button class="close-btn" onclick="closeModal('addWishModal')">✕</button>
            </div>
            <div class="modal-body">
                <div class="wish-form">
                    <div class="form-group">
                        <label>🌈 我的心愿是...</label>
                        <input type="text" id="wishNameInput" placeholder="例如：去游乐园玩" maxlength="30">
                    </div>
                    <div class="form-group">
                        <label>⭐ 需要积攒多少颗星星？</label>
                        <div class="star-amount-input">
                            <button class="amount-btn" onclick="adjustWishAmount(-5)">-5</button>
                            <button class="amount-btn" onclick="adjustWishAmount(-1)">-1</button>
                            <input type="number" id="wishAmountInput" value="10" min="1" max="999">
                            <button class="amount-btn" onclick="adjustWishAmount(1)">+1</button>
                            <button class="amount-btn" onclick="adjustWishAmount(5)">+5</button>
                        </div>
                        <div class="amount-presets">
                            <span onclick="setWishAmount(5)">5颗</span>
                            <span onclick="setWishAmount(10)">10颗</span>
                            <span onclick="setWishAmount(20)">20颗</span>
                            <span onclick="setWishAmount(30)">30颗</span>
                            <span onclick="setWishAmount(50)">50颗</span>
                        </div>
                    </div>
                    <input type="hidden" id="editWishId" value="">
                    <button class="save-wish-btn" onclick="saveWish()">
                        <span>💫</span> 保存心愿
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 兑现心愿确认弹窗 -->
    <div class="modal" id="fulfillWishModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>🎉 实现心愿</h2>
                <button class="close-btn" onclick="closeModal('fulfillWishModal')">✕</button>
            </div>
            <div class="modal-body">
                <div class="fulfill-content">
                    <div class="fulfill-wish-name" id="fulfillWishName">去游乐园玩</div>
                    <div class="fulfill-cost">
                        <span>需要消耗</span>
                        <span class="cost-amount" id="fulfillCost">10</span>
                        <span>颗星星</span>
                    </div>
                    <div class="fulfill-remaining">
                        <span>剩余星星：</span>
                        <span id="fulfillRemaining">5</span>
                        <span>颗</span>
                    </div>
                    <input type="hidden" id="fulfillWishId" value="">
                    <div class="fulfill-buttons">
                        <button class="cancel-btn" onclick="closeModal('fulfillWishModal')">再等等</button>
                        <button class="confirm-fulfill-btn" onclick="confirmFulfillWish()">
                            <span>🎁</span> 实现心愿！
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 已实现心愿列表弹窗 -->
    <div class="modal" id="fulfilledWishesModal">
        <div class="modal-content wish-modal">
            <div class="modal-header">
                <h2>🏆 已实现的心愿</h2>
                <button class="close-btn" onclick="closeModal('fulfilledWishesModal')">✕</button>
            </div>
            <div class="modal-body">
                <div class="fulfilled-list" id="fulfilledWishList">
                    <!-- 已实现心愿将通过JS动态生成 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 星星动画容器 -->
    <div class="star-animation-container" id="starAnimationContainer"></div>

    <!-- Toast提示 -->
    <div class="toast" id="toast"></div>

    <script src="app.js?v=4"></script>
</body>
</html>
